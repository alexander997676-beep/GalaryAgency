<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Galary | Aetheria Studio</title>
    
    <!-- Favicon -->
    <link rel="icon" href="https://n.f-a-k.workers.dev/geminigeneratedimage5497qx5497qx54972.png" type="image/png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Italiana&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        /* --- üåå AETHERIA VARIABLES --- */
        :root {
            --bg: #050505;
            --surface: #0a0a0a;
            --surface-glass: rgba(20, 20, 20, 0.6);
            --text-main: #f0f0f0;
            --text-muted: #888;
            --gold: #c9a45c;
            --accent: #E60023;
            --border: rgba(255, 255, 255, 0.06);
            --ease: cubic-bezier(0.19, 1, 0.22, 1);
            --font-head: 'Italiana', serif;
            --font-body: 'Space Grotesk', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg); color: var(--text-main);
            font-family: var(--font-body); overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- üå† STARFIELD BACKGROUND --- */
        .starfield {
            position: fixed; inset: 0; z-index: -1;
            background: 
                radial-gradient(1px 1px at 50% 50%, rgba(255,255,255,0.1) 50%, transparent 100%),
                radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,0.05) 50%, transparent 100%);
            background-size: 50px 50px, 120px 120px;
            animation: moveStars 100s linear infinite;
        }
        @keyframes moveStars { from { background-position: 0 0; } to { background-position: 100px 100px; } }

        /* --- üíé GLASS HEADER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            padding: 20px 40px; display: flex; justify-content: space-between; align-items: center;
            background: var(--surface-glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border); transition: transform 0.5s var(--ease);
        }
        header.hide { transform: translateY(-100%); }

        .brand { display: flex; align-items: center; gap: 12px; cursor: pointer; }
        .brand img { width: 35px; height: 35px; border-radius: 50%; border: 1px solid var(--gold); }
        .brand-text span { display: block; line-height: 1; }
        .brand .main { font-family: var(--font-body); font-weight: 700; letter-spacing: 2px; }
        .brand .sub { font-family: var(--font-head); color: var(--gold); font-size: 10px; letter-spacing: 4px; }

        .nav-items { display: flex; gap: 20px; }
        .nav-btn {
            background: transparent; border: none; color: var(--text-muted); 
            font-family: var(--font-body); font-weight: 500; font-size: 14px;
            cursor: pointer; position: relative; padding: 5px 0; transition: 0.3s;
        }
        .nav-btn::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 1px;
            background: var(--gold); transition: 0.3s var(--ease);
        }
        .nav-btn.active, .nav-btn:hover { color: white; }
        .nav-btn.active::after { width: 100%; }

        /* --- ‚ö° HERO --- */
        .hero { padding: 180px 20px 60px; text-align: center; }
        .hero h1 {
            font-family: var(--font-head); font-size: clamp(3rem, 10vw, 6rem);
            background: linear-gradient(135deg, #fff 0%, #777 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 20px; line-height: 0.9;
        }
        .made-by {
            font-size: 9px; text-transform: uppercase; letter-spacing: 4px; color: var(--gold);
            margin-bottom: 40px; display: inline-block; padding: 5px 10px;
            border: 1px solid rgba(201, 164, 92, 0.2); border-radius: 20px;
        }

        /* --- üéõÔ∏è CONTROLS --- */
        .controls-wrapper {
            max-width: 600px; margin: 0 auto 50px; display: flex; flex-direction: column; gap: 20px;
        }
        .search-bar { position: relative; width: 100%; }
        .search-input {
            width: 100%; padding: 20px 50px 20px 30px; border-radius: 0; background: transparent;
            border: none; border-bottom: 1px solid var(--border); color: white;
            font-family: var(--font-body); font-size: 18px; transition: 0.3s;
        }
        .search-input:focus { outline: none; border-bottom-color: var(--gold); }
        .search-icon { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

        .tags { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .tag {
            padding: 8px 20px; border: 1px solid var(--border); border-radius: 50px;
            font-size: 12px; color: var(--text-muted); cursor: pointer; transition: 0.3s;
        }
        .tag:hover, .tag.active { border-color: var(--gold); color: white; background: rgba(201, 164, 92, 0.1); }

        /* --- üß± GRID --- */
        .grid {
            column-count: 5; column-gap: 20px; padding: 0 40px; max-width: 2400px; margin: 0 auto;
        }
        @media(max-width:1400px){ .grid{column-count:4;} }
        @media(max-width:1000px){ .grid{column-count:3;} }
        @media(max-width:600px){ .grid{column-count:2; padding:0 15px;} }

        .card {
            break-inside: avoid; margin-bottom: 20px; position: relative;
            background: #111; border-radius: 8px; overflow: hidden;
            transform-style: preserve-3d; perspective: 1000px; cursor: zoom-in;
            opacity: 0; transform: translateY(40px); transition: opacity 0.6s, transform 0.6s;
        }
        .card.visible { opacity: 1; transform: translateY(0); }
        .card img { width: 100%; display: block; transition: 0.4s; }
        .card:hover img { transform: scale(1.05); }

        /* --- üé® STUDIO MODAL --- */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000;
            display: flex; opacity: 0; pointer-events: none; transition: 0.4s var(--ease);
            backdrop-filter: blur(10px);
        }
        .modal.active { opacity: 1; pointer-events: all; }

        .modal-layout { display: flex; width: 100%; height: 100%; }
        
        .studio-preview {
            flex: 1; display: flex; justify-content: center; align-items: center;
            padding: 40px; position: relative;
        }
        .studio-preview img {
            max-width: 100%; max-height: 90vh; box-shadow: 0 0 50px rgba(0,0,0,0.5);
            transition: 0.2s;
        }

        .studio-controls {
            width: 350px; background: #0e0e0e; border-left: 1px solid var(--border);
            padding: 40px 30px; display: flex; flex-direction: column; gap: 30px; overflow-y: auto;
        }
        .studio-header h2 { font-family: var(--font-head); color: white; margin-bottom: 5px; }
        .studio-header p { color: var(--gold); font-size: 12px; letter-spacing: 1px; text-transform: uppercase; }

        .slider-group { display: flex; flex-direction: column; gap: 10px; }
        .slider-label { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-muted); }
        input[type=range] { width: 100%; height: 4px; background: #333; border-radius: 2px; outline: none; appearance: none; }
        input[type=range]::-webkit-slider-thumb { appearance: none; width: 16px; height: 16px; background: var(--gold); border-radius: 50%; cursor: pointer; }

        .btn-group { margin-top: auto; display: flex; flex-direction: column; gap: 10px; }
        .btn {
            padding: 15px; border: 1px solid var(--border); background: transparent;
            color: white; font-family: var(--font-body); font-weight: 700; cursor: pointer;
            transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; font-size: 12px;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn:hover { background: white; color: black; border-color: white; }
        .btn-primary { background: var(--gold); border-color: var(--gold); color: black; }
        .btn-primary:hover { background: #e0c070; }

        .close-modal { position: absolute; top: 20px; left: 20px; color: white; font-size: 24px; cursor: pointer; z-index: 10; }

        @media (max-width: 900px) {
            .modal-layout { flex-direction: column; }
            .studio-preview { height: 50%; padding: 20px; }
            .studio-preview img { max-height: 100%; }
            .studio-controls { width: 100%; height: 50%; border-left: none; border-top: 1px solid var(--border); }
        }

        /* --- üîî TOAST --- */
        .toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: white; color: black; padding: 12px 30px; font-weight: 700;
            font-size: 12px; opacity: 0; transition: 0.4s var(--ease); pointer-events: none; z-index: 6000;
            border-radius: 30px;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    </style>
</head>
<body>

    <div class="starfield"></div>

    <header id="header">
        <div class="brand" onclick="location.reload()">
            <img src="https://n.f-a-k.workers.dev/geminigeneratedimage5497qx5497qx54972.png" alt="Logo">
            <div class="brand-text">
                <span class="main">GALARY</span>
                <span class="sub">AETHERIA</span>
            </div>
        </div>
        <div class="nav-items">
            <button class="nav-btn active" onclick="switchView('grid')">EXPLORE</button>
            <button class="nav-btn" onclick="switchView('fav')">FAVORITES</button>
        </div>
    </header>

    <div class="toast" id="toast">ACTION COMPLETED</div>

    <section class="hero" id="hero">
        <h1>VISUAL<br>ALCHEMY</h1>
        <div class="made-by">Engineered by Faizan Ahmed</div>

        <div class="controls-wrapper">
            <div class="search-bar">
                <input type="text" class="search-input" id="search" placeholder="Search the Aether..." autocomplete="off">
                <i class="fas fa-search search-icon"></i>
            </div>
            <div class="tags">
                <span class="tag active" onclick="search('Random Aesthetic')">Mixed</span>
                <span class="tag" onclick="search('Dark Nature 8k')">Nature</span>
                <span class="tag" onclick="search('Cyberpunk')">Neon</span>
                <span class="tag" onclick="search('Imran Khan')">IK</span>
                <span class="tag" onclick="search('Islamic Geometric')">Islamic</span>
                <span class="tag" onclick="search('Luxury Cars')">Cars</span>
            </div>
        </div>
    </section>

    <div class="grid" id="grid"></div>
    <div style="height: 100px; display:flex; justify-content:center; align-items:center;">
        <i class="fas fa-circle-notch fa-spin" id="loader" style="color:var(--text-muted); opacity:0;"></i>
    </div>

    <!-- STUDIO MODAL -->
    <div class="modal" id="modal">
        <div class="modal-layout">
            <div class="close-modal" onclick="closeModal()"><i class="fas fa-arrow-left"></i></div>
            <div class="studio-preview">
                <img id="preview-img" crossorigin="anonymous" src="">
            </div>
            <div class="studio-controls">
                <div class="studio-header">
                    <h2>STUDIO</h2>
                    <p>Adjust & Download</p>
                </div>
                <div class="slider-group">
                    <div class="slider-label"><span>Brightness</span><span id="val-b">100%</span></div>
                    <input type="range" min="50" max="150" value="100" oninput="updateFilter('brightness', this.value)">
                </div>
                <div class="slider-group">
                    <div class="slider-label"><span>Contrast</span><span id="val-c">100%</span></div>
                    <input type="range" min="50" max="150" value="100" oninput="updateFilter('contrast', this.value)">
                </div>
                <div class="slider-group">
                    <div class="slider-label"><span>Saturation</span><span id="val-s">100%</span></div>
                    <input type="range" min="0" max="200" value="100" oninput="updateFilter('saturate', this.value)">
                </div>
                <div class="slider-group">
                    <div class="slider-label"><span>Grayscale</span><span id="val-g">0%</span></div>
                    <input type="range" min="0" max="100" value="0" oninput="updateFilter('grayscale', this.value)">
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="dl-btn" onclick="downloadEdited()"><i class="fas fa-download"></i> Download Edit</button>
                    <button class="btn" id="fav-btn" onclick="toggleFav()"><i class="far fa-heart"></i> Add to Favorites</button>
                    <button class="btn" onclick="shareImage()"><i class="fas fa-share-nodes"></i> Share</button>
                    <button class="btn" onclick="resetFilters()" style="opacity:0.6; font-size:10px;">Reset Filters</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const API = "https://api.xyro.site/search/pinterest?q=";
        const grid = document.getElementById('grid');
        const loader = document.getElementById('loader');
        
        // State
        let currentQuery = "Aesthetic Wallpapers 4k";
        // Simple local storage for everyone
        let favorites = JSON.parse(localStorage.getItem('aetheria_favs')) || [];
        let currentUrl = "";
        let filters = { brightness: 100, contrast: 100, saturate: 100, grayscale: 0 };
        let view = 'grid';

        // --- INIT ---
        window.onload = () => {
            fetchImages(currentQuery);
            setupScroll();
        };

        // --- FETCH LOGIC ---
        async function fetchImages(query, append = false) {
            loader.style.opacity = 1;
            if(!append) grid.innerHTML = '';

            try {
                const page = Math.floor(Math.random() * 10) + 1;
                const res = await fetch(API + encodeURIComponent(append ? query + ' ' + page : query));
                const data = await res.json();
                
                let imgs = (data.data || data.result || data || []).map(x => 
                    x.image || x.media || x.url || x.display_url || x
                ).filter(u => typeof u === 'string' && u.startsWith('http'));

                imgs.sort(() => Math.random() - 0.5); // Shuffle
                
                imgs.forEach((url, i) => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `<img src="${url}" loading="lazy">`;
                    card.onclick = () => openStudio(url);
                    
                    // 3D Tilt Effect on Desktop
                    card.onmousemove = (e) => {
                        const rect = card.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        card.style.transform = `rotateY(${(x - rect.width/2)/10}deg) rotateX(${-(y - rect.height/2)/10}deg) scale(1.05)`;
                    };
                    card.onmouseleave = () => {
                        card.style.transform = `rotateY(0deg) rotateX(0deg) scale(1)`;
                    };

                    grid.appendChild(card);
                    setTimeout(() => card.classList.add('visible'), i * 80);
                });

            } catch(e) { console.error(e); }
            loader.style.opacity = 0;
        }

        // --- STUDIO LOGIC ---
        function openStudio(url) {
            currentUrl = url;
            const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent(url);
            document.getElementById('preview-img').src = proxyUrl;
            
            resetFilters();
            updateFavBtn();
            document.getElementById('modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function updateFilter(type, val) {
            filters[type] = val;
            const map = { brightness:'val-b', contrast:'val-c', saturate:'val-s', grayscale:'val-g' };
            document.getElementById(map[type]).innerText = val + '%';
            document.getElementById('preview-img').style.filter = `brightness(${filters.brightness}%) contrast(${filters.contrast}%) saturate(${filters.saturate}%) grayscale(${filters.grayscale}%)`;
        }

        function resetFilters() {
            filters = { brightness: 100, contrast: 100, saturate: 100, grayscale: 0 };
            document.querySelectorAll('input[type=range]').forEach(r => {
                r.value = (r.min == 0 && r.max == 100) ? 0 : 100;
            });
            updateFilter('brightness', 100);
        }

        // --- DOWNLOAD ---
        async function downloadEdited() {
            const btn = document.getElementById('dl-btn');
            const oldTxt = btn.innerHTML;
            btn.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> Rendering...`;

            try {
                const img = document.getElementById('preview-img');
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');

                if (!img.complete) await new Promise(r => img.onload = r);

                canvas.width = img.naturalWidth;
                canvas.height = img.naturalHeight;
                ctx.filter = `brightness(${filters.brightness}%) contrast(${filters.contrast}%) saturate(${filters.saturate}%) grayscale(${filters.grayscale}%)`;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.download = `Galary_Edit_${Date.now()}.jpg`;
                    link.href = url;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    showToast("MASTERPIECE SAVED");
                    btn.innerHTML = oldTxt;
                }, 'image/jpeg', 0.95);

            } catch (e) {
                showToast("RENDER FAILED - DOWNLOADING RAW");
                window.open(currentUrl, '_blank');
                btn.innerHTML = oldTxt;
            }
        }

        // --- FAVORITES ---
        function toggleFav() {
            const idx = favorites.indexOf(currentUrl);
            if (idx > -1) {
                favorites.splice(idx, 1);
                showToast("REMOVED FROM FAVORITES");
            } else {
                favorites.push(currentUrl);
                showToast("SAVED TO FAVORITES");
            }
            localStorage.setItem('aetheria_favs', JSON.stringify(favorites));
            updateFavBtn();
            if(view === 'fav') loadFavs();
        }

        function updateFavBtn() {
            const btn = document.getElementById('fav-btn');
            const isFav = favorites.includes(currentUrl);
            btn.innerHTML = isFav ? `<i class="fas fa-heart" style="color:var(--accent)"></i> Saved` : `<i class="far fa-heart"></i> Add to Favorites`;
        }

        function loadFavs() {
            grid.innerHTML = '';
            if(favorites.length === 0) grid.innerHTML = '<div style="width:100%; text-align:center; padding:50px;">NO ARTIFACTS FOUND</div>';
            favorites.forEach(url => {
                const card = document.createElement('div');
                card.className = 'card visible';
                card.innerHTML = `<img src="${url}">`;
                card.onclick = () => openStudio(url);
                grid.appendChild(card);
            });
        }

        // --- UTILS ---
        function search(q) {
            currentQuery = q;
            document.getElementById('search').value = q;
            document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
            switchView('grid');
            fetchImages(q);
        }

        document.getElementById('search').addEventListener('keypress', e => {
            if(e.key === 'Enter') search(e.target.value);
        });

        function switchView(v) {
            view = v;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            if(v === 'grid') {
                document.getElementById('hero').style.display = 'block';
                fetchImages(currentQuery);
            } else {
                document.getElementById('hero').style.display = 'none';
                loadFavs();
            }
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2500);
        }

        function setupScroll() {
            let lastY = 0;
            window.addEventListener('scroll', () => {
                 const h = document.getElementById('header');
                 const currY = window.scrollY;
                 if(currY > lastY && currY > 50) h.classList.add('hide');
                 else h.classList.remove('hide');
                 lastY = currY;
                 
                 if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500 && view === 'grid') {
                     fetchImages(currentQuery, true);
                 }
            });
        }

        async function shareImage() {
            if(navigator.share) {
                navigator.share({ title: 'Galary', url: currentUrl });
            } else {
                navigator.clipboard.writeText(currentUrl);
                showToast("LINK COPIED");
            }
        }

    </script>
</body>
</html>
